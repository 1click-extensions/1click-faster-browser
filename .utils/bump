#!/usr/bin/env coffee

if process.argv.length >= 4

	path = require 'path'
	fs = require 'fs'
	dir = path.resolve process.argv[3]
	manifestFile = dir + '/manifest.json'
	manifest = require manifestFile

	version = manifest.version.match(/^(\d+)\.(\d+)\.(\d+)$/)
	version.shift()

	switch process.argv[2]
		when 'patch' then version[2] = parseInt(version[2]) + 1
		when 'minor' then version[1] = parseInt(version[1]) + 1
		when 'major' then version[0] = parseInt(version[0]) + 1

	version = version.join '.'
	console.log 'version bumped:',version

	manifest.version = version
	fs.writeFileSync manifestFile, JSON.stringify(manifest)

else
	console.log 'usage: bump <action>'
